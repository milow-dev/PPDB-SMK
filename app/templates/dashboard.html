{% extends 'base.html' %}
{% block title %}Dashboard PPDB{% endblock %}

{% block content %}
<div class="container mt-4">
    {% if current_user.role == 'admin' %}
        {% include 'admin_dashboard.html' %}
    {% else %}
    <div class="row">
        <div class="col-md-8 mx-auto">
            <div class="card shadow">
                <div class="card-header bg-primary text-white">
                    <h4 class="mb-0">Status Pendaftaran PPDB</h4>
                </div>
                <div class="card-body">
                    {% if formulir %}
                    <div class="mb-4">
                        <h5>Data Pendaftaran</h5>
                        <div class="alert alert-{{ 'success' if formulir.status == 'approved' else 'warning' if formulir.status == 'pending' else 'danger' }}">
                            Status: {{ formulir.status|upper }}
                            {% if formulir.catatan %}
                            <br>Catatan: {{ formulir.catatan }}
                            {% endif %}
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <p><strong>Nama:</strong> {{ formulir.nama }}</p>
                                <p><strong>TTL:</strong> {{ formulir.ttl }}</p>
                                <p><strong>No HP:</strong> {{ formulir.no_hp }}</p>
                            </div>
                            <div class="col-md-6">
                                <p><strong>Alamat:</strong> {{ formulir.alamat }}</p>
                                <p><strong>Asal Sekolah:</strong> {{ formulir.asal_sekolah }}</p>
                            </div>
                        </div>
                    </div>

                    {% if payment %}
                    <div class="mb-4">
                        <h5>Status Pembayaran</h5>
                        <div class="alert alert-{{ 'success' if payment.status == 'verified' else 'warning' if payment.status == 'pending' else 'danger' }}">
                            Status: {{ payment.status|upper }}
                            {% if payment.catatan %}
                            <br>Catatan: {{ payment.catatan }}
                            {% endif %}
                        </div>
                        <p><strong>Jumlah:</strong> Rp {{ "{:,.0f}".format(payment.amount) }}</p>
                        <p><strong>Tanggal:</strong> {{ payment.payment_date.strftime('%d-%m-%Y %H:%M') }}</p>
                        {% if payment.payment_proof %}
                        <p><strong>Bukti:</strong> 
                            <a href="{{ url_for('static', filename='uploads/' + payment.payment_proof) }}" 
                               target="_blank">Lihat Bukti Pembayaran</a>
                        </p>
                        {% endif %}
                    </div>
                    {% else %}
                    <div class="text-center">
                        <p class="text-warning">Anda belum melakukan pembayaran</p>
                        <a href="{{ url_for('dashboard.payment', formulir_id=formulir.id) }}" 
                           class="btn btn-primary">Upload Pembayaran</a>
                    </div>
                    {% endif %}

                    {% else %}
                    <div class="text-center">
                        <p class="text-warning">Anda belum mengisi formulir pendaftaran</p>
                        <a href="{{ url_for('dashboard.formulir') }}" class="btn btn-primary">Isi Formulir</a>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}